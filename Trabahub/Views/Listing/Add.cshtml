@model Listing

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.7.1/dist/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.7.1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<style>

    .card {
        background-color: skyblue;
        padding: 20px;
        /* From https://css.glass */
        background: rgba(255, 255, 255, 0.2);
        border-radius: 16px;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    /* Limit the width of the file input field */
    #estabIMG {
        max-width: 90%;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
    }

    /* Set the dimensions of the image preview to a circle with a diameter of 2 inches */
    #imgPreview {
        width: 2in;
        height: 2in;
        border-radius: 50%;
        object-fit: cover;
    }

    /* Style for the image placeholder to make it circular */
    #imagePlaceholder {
        width: 2in;
        height: 2in;
        background-color: white;
        border-radius: 50%; /* Makes the placeholder circular */
        display: flex;
        justify-content: center;
        align-items: center;
    }

</style>



<div class="listinglayer ps-5 pt-5 pt-4" id="listinglayer">
    <div class="container">
        <div class="row text-center">
            <div class="col">
                <label class="listingheader">Listing Form</label>
            </div>
        </div>
        <form method="post" asp-action="Add" asp-controller="Listing" id="listingform" enctype="multipart/form-data">
            <div class="centerelement pt-3">
                <div id="imagePlaceholder">
                    <img id="imgPreview" src="">
                </div>
            </div>
            <div class="row centerelement pt-3">
                <div class="col">
                    <div class="input-group">
                        <input type="file" class="form-control" aria-describedby="inputGroupFileAddon04" aria-label="Upload" asp-for="ESTABIMG" id="estabIMG" accept="image/*" required />
                    </div>
                </div>
            </div>
            <div class="row pt-3">
                <div class="col-6">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="estabName" asp-for="ESTABNAME">
                        <label for="estabName">Establishment Name</label>
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="estabDesc" asp-for="ESTABDESC">
                        <label for="estabDesc">Establishment Description</label>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-6">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="estabAdd" asp-for="ESTABADD">
                        <label for="estabAdd">Establishmnt Address</label>
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="estabRate" asp-for="ESTABPRICE">
                        <label for="estabRate">Establishmnt Rates</label>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-6">
                    <div class="form-floating mb-3">
                        <input type="time" asp-for="STARTTIME" class="form-control formatslabel" id="timestart">
                        <label for="timestart">Start Time</label>
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-floating">
                        <input type="time" asp-for="ENDTIME" class="form-control formatslabel" id="timestart">
                        <label for="timestart">End Time</label>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-lg-12">
                    <div class="form-group text-center btn-container">
                        <button type="submit" class="btn btn-success btn-lg" style="width: 25%">List</button>
                        <button type="submit" class="btn btn-danger btn-lg" style="width: 25%" id="cancelBtn">Cancel</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>


<script>
    $(document).ready(function () {

        // Function to clear input fields and reset dropdowns
        function clearInputFields() {
            $("input[name='ESTABNAME']").val('');
            $("input[name='ESTABDESC']").val('');
            $("input[name='ESTABADD']").val('');
            $("input[name='ESTABPRICE']").val('');
            $("input[name='STARTTIME']").val('');
            $("input[name='ENDTIME']").val('');
            // Reset the image placeholder
            $("#imgPreview").attr('src', '');
            $('#imagePlaceholder').css('background-color', 'white');
            $("#estabIMG").val('');
        }

        // Call the clearFormFields function when the page loads
        window.onload = clearInputFields;

        // Click event for the "CANCEL" button
        $('#cancelBtn').click(function () {
            clearInputFields();
            // Prevent the form from submitting
            return false;
        });

    });

    // Function to handle image preview
    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#imgPreview').attr('src', e.target.result);
            };
            reader.readAsDataURL(input.files[0]);
        } else {
            $('#imgPreview').attr('src', ''); // Empty the src attribute
        }
    }

    // Listen for changes in the file input
    $('#estabIMG').change(function () {
        previewImage(this);
    });

</script>


@if (TempData.ContainsKey("FieldError"))
{
    <script>
        var fieldError = '@TempData["FieldError"]';
        Swal.fire({
            icon: 'error',
            title: 'Field Validation Entry Error',
            text: fieldError,
        });
    </script>
}

@if (TempData.ContainsKey("DuplicateError"))
{
    <script>
        var duplicateError = '@TempData["DuplicateError"]';
        Swal.fire({
            icon: 'error',
            title: 'Duplicate Error',
            text: duplicateError,
        });
    </script>
}

@if (TempData.ContainsKey("SuccessMessage"))
{
    <script>
        var successMessage = '@TempData["SuccessMessage"]';
        Swal.fire({
            icon: 'success',
            title: 'Success',
            text: successMessage,
        });
    </script>
}