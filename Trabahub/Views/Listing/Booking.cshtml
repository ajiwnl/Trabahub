@using Microsoft.Extensions.Options
@inject IOptions<Trabahub.Data.StripeSetting> Stripe
@model Listing
<div class="bookinglayer pt-3" id="bookinglayer">
    <div class="container">
        <div class="wrapper">
            <div class="row pb-4">
                <div class="col">
                    <div class="bookingheader border-0">
                        <label class="bnsheader border-0" style="background-color: transparent">@Model.ESTABNAME</label>
                    </div>
                </div>
            </div>
            <div class="bookingside">
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <label class="bfontbody">Select Date</label>
                        </div>
                    </div>
                    <div class="left pt-3">
                        <div class="calendar p-4">
                            <div class="month">
                                <svg class="fas fa-angle-left prev" xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29" fill="none">
                                    <path d="M14.5 21.75L7.25 14.5L14.5 7.25" stroke="#33363F" stroke-width="3" />
                                    <path d="M21.75 21.75L14.5 14.5L21.75 7.25" stroke="#33363F" stroke-width="3" />
                                </svg>
                                <div class="date">January 2024</div>
                                <svg class="fas fa-angle-right next" xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29" fill="none">
                                    <path d="M14.5 21.75L21.75 14.5L14.5 7.25" stroke="#33363F" stroke-width="3" />
                                    <path d="M7.25 21.75L14.5 14.5L7.25 7.25" stroke="#33363F" stroke-width="3" />
                                </svg>
                            </div>
                            <div class="weekdays">
                                <div>S</div>
                                <div>M</div>
                                <div>T</div>
                                <div>W</div>
                                <div>T</div>
                                <div>F</div>
                                <div>S</div>
                            </div>
                            <div class="days"></div>
                            <div class="row">
                                <div class="col">
                                    <div class="goto-today">
                                        <div class="goto">
                                            <input type="text" placeholder="mm/yyyy" class="date-input" />
                                            <button class="goto-btn">Go</button>
                                        </div>
                                        <button class="today-btn" id="todaybtn">Today</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="right" style="display: none">
                        <div class="today-date">
                            <div class="event-day">wed</div>
                            <div class="event-date">12th december 2022</div>
                        </div>
                        <div class="events"></div>
                        <div class="add-event-wrapper">
                            <div class="add-event-header">
                                <div class="title">Add Event</div>
                                <i class="fas fa-times close"></i>
                            </div>
                            <div class="add-event-body">
                                <div class="add-event-input">
                                    <input type="text" placeholder="Event Name" class="event-name" />
                                </div>
                                <div class="add-event-input">
                                    <input type="text"
                                           placeholder="Event Time From"
                                           class="event-time-from" />
                                </div>
                                <div class="add-event-input">
                                    <input type="text"
                                           placeholder="Event Time To"
                                           class="event-time-to" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bookingmain">
                <div class="row">
                    <div class="col">
                        <div class="row">
                            <div class="col text-start">
                                <label class="bfontbheader">Booking Details</label>
                            </div>
                        </div>
                        <div class="row pt-2">
                            <div class="col text-start">
                                <label class="bfontbody" id="dynamicdate"></label>
                            </div>
                        </div>
                        <div class="text-start pt-3">
                            <div class="row">
                                <div class="col-5">
                                    <span class="form-control-static listingbody">Time In</span>
                                    <input class="form-control" type="time" name="timein" id="timein" />
                                </div>
                                <div class="col-5">
                                    <span class="form-control-static listingbody">Time Out</span>
                                    <input class="form-control" type="time" name="timeout" id="timeout" />
                                </div>
                            </div>
                        </div>
                        <div class="text-start pt-3">
                            <div class="row">
                                <div class="col-5">
                                    <span class="form-control-static listingbody">Duration</span>
                                    <input class="form-control" type="text" name="duration" id="duration" readonly />
                                </div>
                                <div class="col-5">
                                    <div class="btn-group mx-auto pt-3" style="width: 100%">
                                        <button type="button" id="priceDropdownBtn" class="btn-lg dropdown-toggle form-control" data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false">
                                            Select Price Option
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-lg-end" id="priceDropdown">
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <input type="text" id="acctbox" hidden />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row pt-5">
                    <div class="col">
                        <a class="dbuttonlbls text-white border-0 text-decoration-none" style="background-color: #F64646;" asp-area="" asp-controller="Listing" asp-action="Details" asp-route-name="@Model.ESTABNAME" asp-route-image="@Model.ESTABIMAGEPATH">GO BACK</a>
                    </div>
                    <div class="col">
                        <a class="dbuttonlbls text-white border-0 text-decoration-none" style="background-color: #3ECCB5;">BOOK NOW</a>
                    </div>
                </div>
                <div class="text-center mt-5">
                    <form action="Charge" asp-controller="Listing" method="post" asp-route-subprice="@Model.ESTABHRPRICE" asp-route-estabname="@Model.ESTABNAME">
                        <article class="mb-2">
                            <label id="amountLabel" class="detailsbody border-0 text-center">Amount: ₱</label>
                            <
                        </article>
                        <script src="//checkout.stripe.com/v2/checkout.js"
                                class="stripe-button"
                                data-key="@Stripe.Value.PublishableKey"
                                data-locale="auto">
                        </script>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Get the time in and time out input elements
    const timeInInput = document.getElementById('timein');
    const timeOutInput = document.getElementById('timeout');

    // Add event listeners to the time inputs
    timeInInput.addEventListener('change', calculateDuration);
    timeOutInput.addEventListener('change', calculateDuration);

    function calculateDuration() {
        // Get the values of time in and time out
        const timeInValue = timeInInput.value;
        const timeOutValue = timeOutInput.value;

        // Convert the time values to Date objects
        const timeIn = new Date('2000-01-01T' + timeInValue);
        const timeOut = new Date('2000-01-01T' + timeOutValue);

        // Calculate the duration in minutes
        const durationInMinutes = (timeOut - timeIn) / (1000 * 60);
        const durationInHours = durationInMinutes / 60;

        // Update the duration input with the calculated value
        const durationInput = document.getElementById('duration');

        let pricePerHour = 100; // Change this to your actual price per hour

        if (durationInHours <= 0) {
            durationInput.value = 'Please Select Appropriate Schedule';
        } else if (durationInHours === 1) {
            durationInput.value = durationInHours + ' Hour';
        } else {
            durationInput.value = durationInHours + ' Hours';
        }

        // Calculate the price based on duration
        const price = durationInHours * pricePerHour;

        // Update the amount label with the calculated price
        const amountLabel = document.getElementById('amountLabel');
        amountLabel.textContent = 'Amount: ₱' + price.toFixed(2); // Assuming price is in PHP

        $(document).ready(function () {
            $('[data-toggle="tooltip"]').tooltip();
        });
    }
</script>

<script>
    var prices = @Html.Raw(Json.Serialize(ViewBag.Prices));

    function clearInputFields() {
        $("input[name='timein']").val('');
        $("input[name='timeout']").val('');
        $("input[name='duration']").val('');
        $("label[id='amountLabel']").text('Amount ₱:');
    }

    Object.entries(prices).forEach(function ([option, price]) {
        var listItem = document.createElement("li");
        var button = document.createElement("button");
        button.className = "dropdown-item";
        button.type = "button";
        button.textContent = option + ": ₱" + price;
        button.onclick = function () {
            handleSelection(option, price);
            if (option === "Hourly Price") {
                clearInputFields();
            }
        };
        listItem.appendChild(button);
        document.getElementById("priceDropdown").appendChild(listItem);
    });
</script>

<script>
    function handleSelection(option, price) {
        document.getElementById("priceDropdownBtn").innerText = option + ": ₱" + price;

        var updatePrice = price;

        $.ajax({
            type: "POST",
            url: "/Listing/SetPrice",
            data: { price: updatePrice },
            success: function (response) {
                var bookingForm = document.getElementById("bookingForm");
                bookingForm.setAttribute("asp-route-subprice", response.price);
            },
            error: function (xhr, status, error) {
                console.error("Something Went Wrong", error);
            }
        });

        document.getElementById("amountLabel").textContent = "Amount: ₱" + price;
    }
</script>






