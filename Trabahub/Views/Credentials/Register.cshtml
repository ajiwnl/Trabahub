@model Credentials
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="registerlayer" id="registerlayer">
	<div class="logincontainer">
		<div class="wrapper registerbody">
			<div class="registerside pb-5">
				<div class="container">
					<div class="row">
						<div class="col">
							<img src="~/res/LargeLogo.png" class="loginlogo" />
						</div>
					</div>
					<div class="row">
						<div class="col">
							<label class="loginheader text-white">CO-WORKING SPACES AND STUDY HUBS IN CEBU</label>
						</div>
					</div>
					<div class="row pt-3">
						<div class="col">
							<label class="loginheaderb text-white">In An Innovative Environment</label>
						</div>
					</div>
				</div>
			</div>
			<div class="registermain" id="registercard">
				<div class="container">
					<div class="row pt-3">
						<div class="col">
							<label class="text-center h2 text-white fontsign" style="font-family: 'Noto Sans', sans-serif; font-weight: 700">Sign Up</label>
						</div>
					</div>
					<div class="row">
						<div class="col">
							<label class="loginheaderb text-white">For an Account</label>
						</div>
					</div>
					<form method="post" asp-action="Register" asp-controller="Credentials" id="registerform">
						<div class="row pt-4">
							<div class="col-2 pt-3">
								<i class="fa-solid fa-user fa-2xl" style="color: #ffffff;"></i>
							</div>
							<div class="col-10">
								<div class="form-floating mb-3">
									<input asp-for="Username" type="text" class="form-control" id="usernamereg" placeholder="Username001" minlength="4" maxlength="15" required />
									<label for="username">Username</label>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-2 pt-3">
								<i class="fa-solid fa-envelope fa-2xl" style="color: #ffffff;"></i>
							</div>
							<div class="col-10">
								<div class="form-floating mb-3">
									<input asp-for="Email" type="email" class="form-control" id="emailreg" placeholder="trabahubuser@example.com" maxlength="255" required />
									<label for="floatingInput">Email address</label>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-2 pt-3">
								<i class="bi bi-shield-fill-check" style="font-size: 2rem; color: #ffffff;"></i>
							</div>
							<div class="col-10">
								<div class="form-floating mb-3">
									<input class="form-control" asp-for="VerificationCode" id="verifyreg" placeholder="trabahubuser@example.com" maxlength="255" required />
									<label for="floatingInput">Verification Code</label>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-2 pt-3">
								<i class="fa-solid fa-lock fa-2xl" style="color: #ffffff;"></i>
							</div>
							<div class="col-10">
								<div class="form-floating mb-3">
									<input asp-for="Password" type="password" class="form-control" id="passwordreg" placeholder="Password" minlength="10" maxlength="255" required disabled />
									<label for="floatingPassword">Password</label>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-2 pt-3">
								<i class="fa-solid fa-key fa-2xl" style="color: #ffffff;"></i>
							</div>
							<div class="col-10">
								<div class="form-floating mb-3">
									<input type="password" class="form-control" id="confirmPassword" placeholder="Confirm Password" oninput="checkPasswordMatch()" required disabled />
									<label for="confirmPassword">Confirm Password</label>
									<span id="passwordMatchError" class="text-danger"></span>
								</div>
							</div>
						</div>
						<div class="row pt-4 pb-2">
							<div class="col">
								<button type="submit" id="registerButton" class="dbuttonlbls text-white border-0 text-decoration-none rounded-1" style="background-color: #3ECCB5;" disabled>Register</button>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	$(document).ready(function () {
		// Handle key press event when user presses enter in the email input field
		$('#emailreg').keypress(function (e) {
			if (e.which === 13) { // 13 is the enter key code
				e.preventDefault(); // Prevent default form submission
				sendVerificationEmail();
			}
		});

		// Function to send verification code via AJAX
		function sendVerificationEmail() {
			var email = $('#emailreg').val(); // Get the email input value

			// AJAX call to send verification code
			$.ajax({
				url: '/Credentials/SendEmail', // Change the URL if needed
				type: 'POST',
				data: { email: email },
				success: function (response) {
					// Handle success response
					// Set the value of the input field with ID verifyreg to the received verification code
					$('#verifyreg').val(response.verificationCode);

					// Show a success message using SweetAlert
					Swal.fire({
						icon: 'success',
						title: 'Success',
						text: 'Verification email sent successfully. Check your email.'
					});
				},
				error: function (xhr, status, error) {
					// Handle error response
					// Show an error message using SweetAlert
					Swal.fire({
						icon: 'error',
						title: 'Error',
						text: 'Failed to send verification email. Please try again later.'
					});
				}
			});
		}

		// Send verification email automatically every 1 minute
		setInterval(sendVerificationEmail, 60000); // 60000 milliseconds = 1 minute
	});

</script>


@if (TempData.ContainsKey("EmailExists"))
{
	<script>
		var errorMessage = '@TempData["EmailExists"]';
		Swal.fire({
			icon: 'error',
			title: 'Error',
			text: errorMessage,
		});
	</script>
}

@if (TempData.ContainsKey("PasswordExists"))
{
	<script>
		var errorMessage = '@TempData["UserExists"]';
		Swal.fire({
			icon: 'error',
			title: 'Error',
			text: errorMessage,
		});
	</script>
}

@if (TempData.ContainsKey("SuccessMessage"))
{
	<script>
		var successMessage = '@TempData["SuccessMessage"]';
		Swal.fire({
			icon: 'success',
			title: 'Success',
			text: successMessage,
		});
	</script>
}